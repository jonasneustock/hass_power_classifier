services:
  app:
    image: ghcr.io/jonasneustock/hass-power-classifier:latest
    #build: .
    ports:
      - "8000:8000"
    environment:
      - HA_BASE_URL=http://192.168.2.225:8123
      - HA_TOKEN=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiI1MWNjMTQ5NGFmZGI0YjdjYmMyYWIwMmUxMDk0NDZiYiIsImlhdCI6MTc2NjMxNjEzNCwiZXhwIjoyMDgxNjc2MTM0fQ.uOLyT72tlJXx5cW-muVDzn9aZrTJgMu0WzlM7k00dG8
      # Alternative: use multiple sensors (comma separated)
      - HA_POWER_SENSORS=sensor.strom_channel_a_power,sensor.strom_channel_b_power,sensor.strom_channel_c_power,sensor.shellyem3_485519dca648_phase_a_power,sensor.shellyem3_485519dca648_phase_b_power,sensor.shellyem3_485519dca648_phase_c_power
      - POLL_INTERVAL_SECONDS=1
      - RELATIVE_CHANGE_THRESHOLD=0.05
      - SEGMENT_PRE_SAMPLES=15
      - SEGMENT_POST_SAMPLES=15
      - MIN_LABELS_PER_APPLIANCE=5
      - STATUS_TTL_SECONDS=300
      - APP_TITLE=HA Power Classifier
      - DATA_DIR=/data
      - MQTT_ENABLED=true
      - MQTT_HOST=192.168.2.225
      - MQTT_PORT=1883
      - MQTT_USERNAME=
      - MQTT_PASSWORD=
      - MQTT_BASE_TOPIC=ha_power_classifier
      - MQTT_DISCOVERY_PREFIX=homeassistant
      - MQTT_CLIENT_ID=ha-power-classifier
      - MQTT_DEVICE_ID=ha_power_classifier
    volumes:
      - ha_power_classifier_data:/data
volumes:
  ha_power_classifier_data:
