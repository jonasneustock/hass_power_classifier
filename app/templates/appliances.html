{% extends "layout.html" %}
{% block content %}
<section class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
  <div class="flex items-center justify-between">
    <h2 class="text-lg font-semibold">Register appliance</h2>
  </div>
  {% if error %}
  <div class="mt-3 rounded-lg border border-amber-300 bg-amber-50 px-4 py-3 text-sm text-amber-800">{{ error }}</div>
  {% endif %}
  <form class="mt-4 grid gap-4" method="post" action="/appliances">
    <label class="text-sm font-medium text-slate-700">
      Appliance name
      <input class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" type="text" name="name" value="{{ form.name if form }}" required />
    </label>
    <label class="text-sm font-medium text-slate-700">
      Power entity id
      <input class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" type="text" name="power_entity_id" placeholder="sensor.toaster_power" value="{{ form.power_entity_id if form }}" required />
    </label>
    {% if config.mqtt_enabled %}
    <p class="text-sm text-slate-500">When MQTT is enabled, the entity IDs are used as discovery object IDs.</p>
    {% endif %}
    <button class="inline-flex w-fit items-center rounded-lg bg-slate-900 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-slate-800" type="submit">Create appliance</button>
  </form>
</section>

<section class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
  <div class="flex items-center justify-between">
    <h2 class="text-lg font-semibold">Configured appliances</h2>
  </div>
  {% if appliances %}
  <div class="mt-4 grid gap-4 md:grid-cols-2">
    {% for appliance in appliances %}
    <div class="rounded-xl border border-slate-200 p-4">
      <h3 class="text-base font-semibold">{{ appliance.name }}</h3>
      <p class="text-sm text-slate-600">Power entity: {{ appliance.power_entity_id }}</p>
      {% if config.mqtt_enabled %}
      <p class="text-sm text-slate-600">MQTT power topic: <code class="rounded bg-slate-100 px-2 py-1 text-xs text-slate-700">{{ appliance.power_state_topic }}</code></p>
      <p class="text-xs text-slate-500">
        Discovery: <code class="rounded bg-slate-100 px-2 py-1 text-xs text-slate-700">{{ appliance.power_config_topic }}</code>
      </p>
      {% endif %}
      <p class="text-sm text-slate-600">Learned power (min/mean/max): {{ appliance.min_power or 0 }} / {{ appliance.mean_power or appliance.running_watts or 0 }} / {{ appliance.max_power or 0 }} W</p>
      <p class="text-sm text-slate-600">Last status: {{ appliance.last_status or 'unknown' }}</p>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <p class="mt-2 text-sm text-slate-500">No appliances configured yet.</p>
  {% endif %}
</section>
{% endblock %}
